<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="VikwqTxe7ybu1qSM7LFgIQpvHLN0_j-iVzaLqF88vEw" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matt Swanson - Weekly Noise 2 Recap - alert("It's working!");</title>
  <meta name="author" content="Matt Swanson" />
  <meta name="description" content="writing on software, book writeups and projects by a software engineer from Indianapolis" />
  
  <link rel="canonical" href="http://mdswanson.com/blog/2010/11/07/weekly-noise-2-recap.html" />

  <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/static/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Matt Swanson's Blog" href="http://localhost:4000/atom.xml" />

  
    <link rel="stylesheet" href="/css/site.css">
  
</head>
<body>
  <section>
    <header class="navigation">
  <a href="/" class="logo" title="ÄLG, a solitary moose.">
    <img src="/static/moose.png" alt="Moose">
  </a>
  <nav>
    <ul>
      <li><a href="/">writing</a></li>
      <li><a href="/archive">archive</a></li>
      <li><a href="/about">about</a></li>
      <li class="no-bullet"><a href="/atom.xml">rss</a></li>
    </ul>
  </nav>
</header>

<article>
  <h1 class="title">
    Weekly Noise 2 Recap - alert("It's working!");
  </h1>

  
  <p class="subtitle">
    
      <span>
        
          Series:
          
            
              <a href="/#worklog">worklog</a>
            
          
        
      </span>

      <span class="date">
        November 07, 2010
      </span>
    
  </p>

  <div id="post"><p>The past week I have been working on a 
<a href="http://mdswanson.com/blog/2010/10/31/weekly-noise-2-so-its-like-a-screensaver.html">web-based “announcement board”</a> 
using a <a href="http://mdswanson.com/blog/2010/11/03/sipping-the-nodejs-koolaid.html">slew of Javascript libraries</a>.</p>

<p>So how did I do? Well I hit all my goals for the week, which were:</p>

<ul>
  <li>Get a static page up that receives WebSocket updates ✓</li>
  <li>Make a simple Admin page to CRUD announcement items ✓</li>
  <li>Get basic animation going for the background ✓</li>
</ul>

<p>The static page was simple enough to setup, especially since I have used <code class="highlighter-rouge">socket.io</code> 
before.  I added some basic styling to play around with some CSS3 stuff (<code class="highlighter-rouge">border-radius</code> 
and <code class="highlighter-rouge">box-shadow</code> are pretty slick).  I send a payload and an action type over <code class="highlighter-rouge">socket.io</code> 
to the page and then perform the appropriate action – adding an announcement, editing 
the message or removing it all together – with <code class="highlighter-rouge">jQuery</code>.</p>

<p><a href="/static/week2-index.png"><img src="/static/week2-index-thumb.png" alt="" /></a></p>

<p>Next, I setup an “Edit” page where you can CRUD announcements.  I used jQuery 
Ajax POSTs to trigger the actions in the database.</p>

<p>Since I am serving the pages with <code class="highlighter-rouge">node.js</code>, I had to adjust to an asynchronous programming 
model.  I haven’t been able to wrap my head around this concept in the past – my previous 
attempts at using <code class="highlighter-rouge">monocle</code> and <code class="highlighter-rouge">twisted</code> always ended with me frustrated and discouraged.</p>

<p>I spent some time trying to debug why I was not able to pull some documents out of <code class="highlighter-rouge">MongoDB</code>
and pass them to the template.  It took me a while to realize that I need to put the 
rendering function in the callback for the database query.  Otherwise, my application was 
happy to go on ahead and render the page with an empty array.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">//Bad!</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/edit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">stored_items</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="c1">//pull some data out of mongo</span>
  <span class="nx">Announcement</span><span class="p">.</span><span class="nx">fetch_active</span><span class="p">().</span><span class="nx">all</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">stored_items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">body</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">//pass the results to the template</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'edit.jade'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">locals</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="s1">'Edit Announcements'</span><span class="p">,</span>
        <span class="na">items</span><span class="p">:</span> <span class="nx">stored_items</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>Putting the <code class="highlighter-rouge">res.render()</code> in the callback ensures that the query has finished and the 
page will receive the proper data.  I imagine this code could still be improved with some 
kind of asynchronous <code class="highlighter-rouge">map</code> function instead of a for-loop, but it works well enough at the moment.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">//Good! (well, better at least...)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/edit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">stored_items</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="c1">//pull some data out of mongo</span>
  <span class="nx">Announcement</span><span class="p">.</span><span class="nx">fetch_active</span><span class="p">().</span><span class="nx">all</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">stored_items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">body</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//pass the results to the template</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'edit.jade'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">locals</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">title</span><span class="p">:</span> <span class="s1">'Edit Announcements'</span><span class="p">,</span>
        <span class="na">items</span><span class="p">:</span> <span class="nx">stored_items</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>I also ran into a problem with binding jQuery <code class="highlighter-rouge">onClick</code> callbacks.  Since all of the CRUD functionality 
uses Ajax POSTs, I was constructing the new announcement divs on-the-fly.  If you use the 
normal <code class="highlighter-rouge">$('#foo').click( ... )</code> jQuery code, only the DOM elements that are present when that 
function is executed actually get bound.</p>

<p>As a result, any new elements that I add (like when I 
created a new announcement) would not respond to events.  Fortunately, this is easily fixed by using 
<a href="http://api.jquery.com/live/"><code class="highlighter-rouge">.live()</code></a>, which binds the event handlers to all selector matches, 
even those created dynamically.</p>

<p><img src="/static/week2-edit.png" alt="/static/week2-edit.png" /></p>

<p>The last goal was to get a simple animation going in the background using <code class="highlighter-rouge">raphael.js</code>.<br />
I want to be able to generate a bunch of polygons and then have them animate along a path.
Once the polygon goes offscreen, my plan is to loop it around back to where it started to 
give the illusion of an endless stream.</p>

<p>I used <code class="highlighter-rouge">inkscape</code> to make an SVG path (which is really just a string of coordinates and 
commands) and then had a spinning square follow the path.  Since the SVG element lives in 
the DOM along with the other page elements, I needed to set the <code class="highlighter-rouge">zIndex</code> so that the 
animation would appear underneath the other text and images on the screen.</p>

<p>All together, it was a productive week.  Despite hitting a few obstacles, I learned a 
few new tricks and made good progress; the source code for the app is on 
<a href="https://github.com/swanson/glorified-screensaver">Github</a> so feel free to take a look.</p>
</div>      

  
    <hr class="fin"/>
  
</article>


  <footer>
  <div id="bio">
    <div id="bio-image">
      <img src="/static/mugshot.jpg" alt="Matt Swanson">
    </div>
    
    <div id="bio-text">
      <p>Hi. I'm <b>Matt Swanson</b>.</p>
      <p>I do things and sometimes write about it here. I'm a Software Engineer from Indiana and I ship code at <a href="http://www.sep.com/">SEP</a>.</p>
      
      <div id="bio-social">
        <strike>Stalk</strike> Follow me:
<div id="social-links">
  <a title="swanson on Github" href="http://github.com/swanson/"><i class="fa fa-github-square"></i></a>
  <a title="swanson on Hacker News" href="http://news.ycombinator.com/user?id=swanson"><i class="fa fa-hacker-news"></i></a>
  <a title="_swanson on Twitter" href="http://twitter.com/_swanson"><i class="fa fa-twitter-square"></i></a>
  <a title="RSS feed" id="rss" href="/atom.xml"><i class="fa fa-rss-square"></i></a>
</div>
      </div>
    </div>
  </div>

  
  <aside>
    <h3>Further reading</h3>
    <ul class="posts">
      
        
        
          
            <li><a href="/blog/2013/08/07/interview-to-implementation-horizon-report.html">Interview to Implementation: Horizon Report</a></li>
          
        
          
            <li><a href="/blog/2013/07/24/step-by-step-ux-improvement-screenshot-upload.html">Step-by-Step UX Improvement: Screenshot Upload</a></li>
          
        
          
            <li><a href="/blog/2011/08/21/update-on-lanyon-crossdomain-ajax-posts.html">Update on Lanyon + Cross-domain AJAX POSTs with CORS</a></li>
          
        
      
    </ul>
  </aside>
  
</footer>

<div id="fine-print">
  <p>
    built with <a href="#">&hearts;</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="https://github.com/swanson/swanson.github.com">GitHub Pages</a> &mdash; read the <a href="/legal">fine print</a>
  </p>
</div>

  </section>

  
</body>
</html>
