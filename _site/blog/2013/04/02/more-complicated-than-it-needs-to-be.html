<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="VikwqTxe7ybu1qSM7LFgIQpvHLN0_j-iVzaLqF88vEw" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matt Swanson - More Complicated Than It Needs To Be</title>
  <meta name="author" content="Matt Swanson" />
  <meta name="description" content="writing on software, book writeups and projects by a software engineer from Indianapolis" />
  
  <link rel="canonical" href="http://mdswanson.com/blog/2013/04/02/more-complicated-than-it-needs-to-be.html" />

  <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/static/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Matt Swanson's Blog" href="http://localhost:4000/atom.xml" />

  
    <link rel="stylesheet" href="/css/site.css">
  
</head>
<body>
  <section>
    <header class="navigation">
  <a href="/" class="logo" title="ÄLG, a solitary moose.">
    <img src="/static/moose.png" alt="Moose">
  </a>
  <nav>
    <ul>
      <li><a href="/">writing</a></li>
      <li><a href="/archive">archive</a></li>
      <li><a href="/about">about</a></li>
      <li class="no-bullet"><a href="/atom.xml">rss</a></li>
    </ul>
  </nav>
</header>

<article>
  <h1 class="title">
    More Complicated Than It Needs To Be
  </h1>

  
  <p class="subtitle">
    
      <span>
        
          Series:
          
            
              <a href="/#delightful_products">delightful products</a>
            
          
        
      </span>

      <span class="date">
        April 02, 2013
      </span>
    
  </p>

  <div id="post"><blockquote>
  <p>Once you’ve hit the point where a simpler pattern isn’t working for you anymore and you have to start using the more complicated one, [there’s a natural tendency] to then always reach for the complicated one in other situations where the simple one would be just fine. <cite style="float: right;"><a href="http://rubyrogues.com/097-rr-book-club-patterns-of-enterprise-architecture-with-martin-fowler/">Martin Fowler</a></cite></p>
</blockquote>

<p>The Boss needs an app to capture employee suggestions — we can’t use a cardboard box with 
a cut-out slot, we are a software company!</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SuggestionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_filter</span> <span class="ss">:authenticate!</span>
  <span class="n">before_filter</span> <span class="ss">:boss_only</span><span class="p">,</span> <span class="ss">except: </span><span class="p">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@suggestions</span> <span class="o">=</span> <span class="no">Redis</span><span class="p">.</span><span class="nf">find_by_key</span><span class="p">(</span><span class="s2">"suggestions"</span><span class="p">)</span>
    
    <span class="k">unless</span> <span class="vi">@suggestions</span>
      <span class="vi">@suggestions</span> <span class="o">=</span> <span class="no">Respository</span><span class="p">.</span><span class="nf">for</span><span class="p">(</span><span class="ss">:suggestion</span><span class="p">).</span><span class="nf">all</span>

      <span class="no">Resque</span><span class="p">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="no">CacheSuggestionJob</span><span class="p">,</span> <span class="vi">@suggestions</span><span class="p">)</span>
      <span class="no">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="no">I18n</span><span class="p">.</span><span class="nf">t</span><span class="p">(</span><span class="ss">:cache_not_warm</span><span class="p">))</span>
    <span class="k">end</span>

    <span class="vi">@suggestions</span> <span class="o">=</span> <span class="no">SuggestionDecorator</span><span class="p">.</span><span class="nf">decorate_collection</span><span class="p">(</span><span class="vi">@suggestions</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@suggestion</span> <span class="o">=</span> <span class="no">FormBuilder</span><span class="p">.</span><span class="nf">for</span><span class="p">(</span><span class="ss">:suggestion</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@suggestion</span> <span class="o">=</span> <span class="no">Suggestion</span><span class="p">.</span><span class="nf">new</span> <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:idea</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:category</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@suggestion</span><span class="p">.</span><span class="nf">valid?</span>
      <span class="n">current_user</span><span class="p">.</span><span class="nf">extend</span> <span class="no">SuggestionSubmitter</span>
      <span class="n">current_user</span><span class="p">.</span><span class="nf">suggest</span><span class="p">(</span><span class="vi">@suggestion</span><span class="p">)</span>

      <span class="no">Resque</span><span class="p">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="no">NotifyBossJob</span><span class="p">,</span> <span class="vi">@suggestion</span><span class="p">)</span> <span class="k">unless</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">intern?</span>
      <span class="no">Resque</span><span class="p">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="no">AddToDailyEmailDigestJob</span><span class="p">,</span> <span class="vi">@suggestion</span><span class="p">)</span>

      <span class="n">flash</span><span class="p">[</span><span class="ss">:success</span><span class="p">]</span> <span class="o">=</span> <span class="no">I18n</span><span class="p">.</span><span class="nf">t</span><span class="p">(</span><span class="ss">:thank_you</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">root_url</span>
    <span class="k">else</span>
      <span class="no">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="no">I18n</span><span class="p">.</span><span class="nf">t</span><span class="p">(</span><span class="ss">:invalid_suggestion_attempt</span><span class="p">),</span> 
                 <span class="n">current_user</span><span class="p">,</span> <span class="vi">@suggestion</span><span class="p">)</span>
      
      <span class="n">flash</span><span class="p">[</span><span class="ss">:error</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@suggestion</span><span class="p">.</span><span class="nf">error_messages</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Sometimes simple is better.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SuggestionBox</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s2">"/"</span> <span class="k">do</span>
    <span class="n">erb</span> <span class="ss">:form</span>
  <span class="k">end</span>

  <span class="n">post</span> <span class="s2">"/suggest"</span> <span class="k">do</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:idea</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>

    <span class="c1"># The Boss ♥'s Dropbox</span>
    <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'~/Dropbox/suggestion_box.txt'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">){</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">flash</span><span class="p">[</span><span class="ss">:success</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Thanks!"</span>
    <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
</div>      

  
    <hr class="fin"/>
  
</article>


  <footer>
  <div id="bio">
    <div id="bio-image">
      <img src="/static/mugshot.jpg" alt="Matt Swanson">
    </div>
    
    <div id="bio-text">
      <p>Hi. I'm <b>Matt Swanson</b>.</p>
      <p>I do things and sometimes write about it here. I'm a Software Engineer from Indiana and I ship code at <a href="http://www.sep.com/">SEP</a>.</p>
      
      <div id="bio-social">
        <strike>Stalk</strike> Follow me:
<div id="social-links">
  <a title="swanson on Github" href="http://github.com/swanson/"><i class="fa fa-github-square"></i></a>
  <a title="swanson on Hacker News" href="http://news.ycombinator.com/user?id=swanson"><i class="fa fa-hacker-news"></i></a>
  <a title="_swanson on Twitter" href="http://twitter.com/_swanson"><i class="fa fa-twitter-square"></i></a>
  <a title="RSS feed" id="rss" href="/atom.xml"><i class="fa fa-rss-square"></i></a>
</div>
      </div>
    </div>
  </div>

  
  <aside>
    <h3>Further reading</h3>
    <ul class="posts">
      
        
        
          
            <li><a href="/blog/2017/02/14/why-machine-learning-is-interesting.html">Software ate the world</a></li>
          
        
          
            <li><a href="/blog/2013/10/14/how-not-to-validate-email-addresses.html">How not to validate email addresses</a></li>
          
        
          
            <li><a href="/blog/2013/09/30/crappy-emails-make-me-sad.html">Crappy emails make me sad</a></li>
          
        
      
    </ul>
  </aside>
  
</footer>

<div id="fine-print">
  <p>
    built with <a href="#">&hearts;</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="https://github.com/swanson/swanson.github.com">GitHub Pages</a> &mdash; read the <a href="/legal">fine print</a>
  </p>
</div>

  </section>

  
</body>
</html>
