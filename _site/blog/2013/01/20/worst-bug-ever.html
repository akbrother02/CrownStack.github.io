<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="VikwqTxe7ybu1qSM7LFgIQpvHLN0_j-iVzaLqF88vEw" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matt Swanson - Worst. Bug. Ever.</title>
  <meta name="author" content="Matt Swanson" />
  <meta name="description" content="writing on software, book writeups and projects by a software engineer from Indianapolis" />
  
  <link rel="canonical" href="http://mdswanson.com/blog/2013/01/20/worst-bug-ever.html" />

  <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/static/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Matt Swanson's Blog" href="http://localhost:4000/atom.xml" />

  
    <link rel="stylesheet" href="/css/site.css">
  
</head>
<body>
  <section>
    <header class="navigation">
  <a href="/" class="logo" title="ÄLG, a solitary moose.">
    <img src="/static/moose.png" alt="Moose">
  </a>
  <nav>
    <ul>
      <li><a href="/">writing</a></li>
      <li><a href="/archive">archive</a></li>
      <li><a href="/about">about</a></li>
      <li class="no-bullet"><a href="/atom.xml">rss</a></li>
    </ul>
  </nav>
</header>

<article>
  <h1 class="title">
    Worst. Bug. Ever.
  </h1>

  
  <p class="subtitle">
    
      <span>
        
          Series:
          
            
              <a href="/#reflections">reflections</a>
            
          
        
      </span>

      <span class="date">
        January 20, 2013
      </span>
    
  </p>

  <div id="post"><p>Some bugs are the worst because they <a href="http://money.cnn.com/2012/08/09/technology/knight-expensive-computer-bug/index.html">cost money</a>. Some because they <a href="http://en.wikipedia.org/wiki/Therac-25">cost lives</a>.</p>

<p>Others would cite bugs buried deep in a <a href="https://groups.google.com/forum/#!topic/rubyonrails-security/61bkgvnSGTQ/discussion">framework</a> or <a href="http://en.wikipedia.org/wiki/Therac-25">hardware</a> as “the worst”.</p>

<p>For me, the worst kind of bugs are those where the solution, in hindsight, seemed
so obvious. You end up more frustrated with the bug after knowing the fix.</p>

<hr />

<p>I encountered my worst bug during a summer internship after my sophomore year of
school. I was helping a research team at Purdue write simulation tools for
nanophotonics — I say this not to sound like I was some kind of genius, but
to highlight that I was in over my head in a very unfamiliar domain.</p>

<p>A group of research scientists and grad students would work out the math needed
to simulate the performance of different nano-scale lenses and I was responsible for
wrapping the computations in a web interface and plotting the results.</p>

<p>The team had an existing set of MATLAB scripts that they used internally, but these
scripts were hard to modify and distribute. But, on the bright side, I could hook into 
the MATLAB scripts and leverage their existing work.</p>

<p>When I finally got everything wired up and started comparing the results of a few test 
cases, they didn’t match. I did my best to debug the MATLAB script, but the math 
was outside of my comprehension (optics theorems, higher order integrals, and 
complex numbers). And when I ran the simulation with the same inputs in the stand-alone script, 
I would get the correct results. <em>Hmm.</em></p>

<p>The web interface was built on a proprietary framework — it could leverage an entire 
grid computing cluster as the backend, but wasn’t exactly something that StackOverflow could 
help with.</p>

<p>After about of week of stepping through the code line by line (even verifying some of the
calculations by hand), I finally isolated the section of code where the results diverged.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>for i=1:length(LensLayers)
  d[i] = compute_diffraction_at_wavelength(LensLayers[i], WAVELENGTH)
end
</code></pre>
</div>

<p>It seemed pretty innocuous; loop over an array, perform a calculation on each element, store
the result in another array.</p>

<p>Do you see the bug?</p>

<p>Remember when I said there were some PhD-level computations being done? Most of them dealt with
complex numbers, which are natively support in MATLAB like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>x = 2 + 3*i
</code></pre>
</div>

<p>Figure it out yet?</p>

<p>I was using <code class="highlighter-rouge">i</code> as my loop index, but as a side-effect the imaginary constant <code class="highlighter-rouge">i</code> in MATLAB 
was getting overwritten! So <code class="highlighter-rouge">2 + 3*i</code> was evaluating to <code class="highlighter-rouge">5</code> for the first iteration, <code class="highlighter-rouge">8</code> for 
the second, etc. <em>Sigh.</em></p>

<p>Changing the loop variable name immediately fixed the problem and the results became 
correct (an alternate solution is to use <code class="highlighter-rouge">3i</code> instead of <code class="highlighter-rouge">3*i</code>).</p>

<hr />

<p>To this day, I’ve never run across another bug with such a <strong>frustratingly obvious solution</strong>.</p>

<p>It may have taken three weeks to solve, but at least I got a good “Worst. Bug. Ever.” story out of it.</p>
</div>      

  
    <hr class="fin"/>
  
</article>


  <footer>
  <div id="bio">
    <div id="bio-image">
      <img src="/static/mugshot.jpg" alt="Matt Swanson">
    </div>
    
    <div id="bio-text">
      <p>Hi. I'm <b>Matt Swanson</b>.</p>
      <p>I do things and sometimes write about it here. I'm a Software Engineer from Indiana and I ship code at <a href="http://www.sep.com/">SEP</a>.</p>
      
      <div id="bio-social">
        <strike>Stalk</strike> Follow me:
<div id="social-links">
  <a title="swanson on Github" href="http://github.com/swanson/"><i class="fa fa-github-square"></i></a>
  <a title="swanson on Hacker News" href="http://news.ycombinator.com/user?id=swanson"><i class="fa fa-hacker-news"></i></a>
  <a title="_swanson on Twitter" href="http://twitter.com/_swanson"><i class="fa fa-twitter-square"></i></a>
  <a title="RSS feed" id="rss" href="/atom.xml"><i class="fa fa-rss-square"></i></a>
</div>
      </div>
    </div>
  </div>

  
  <aside>
    <h3>Further reading</h3>
    <ul class="posts">
      
        
        
          
            <li><a href="/blog/2014/06/29/meditations-on-software.html">Personal Meditations on Software</a></li>
          
        
          
            <li><a href="/blog/2014/02/10/my-year-in-review-2013.html">My Year in Review: 2013</a></li>
          
        
          
            <li><a href="/blog/2013/05/02/expanding-contracting.html">Expanding and Contracting</a></li>
          
        
      
    </ul>
  </aside>
  
</footer>

<div id="fine-print">
  <p>
    built with <a href="#">&hearts;</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="https://github.com/swanson/swanson.github.com">GitHub Pages</a> &mdash; read the <a href="/legal">fine print</a>
  </p>
</div>

  </section>

  
</body>
</html>
