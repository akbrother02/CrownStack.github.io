<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="VikwqTxe7ybu1qSM7LFgIQpvHLN0_j-iVzaLqF88vEw" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matt Swanson - Digging around the Github v3 API</title>
  <meta name="author" content="Matt Swanson" />
  <meta name="description" content="writing on software, book writeups and projects by a software engineer from Indianapolis" />
  
  <link rel="canonical" href="http://mdswanson.com/blog/2011/07/09/digging-around-the-github-v3-api.html" />

  <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/static/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Matt Swanson's Blog" href="http://localhost:4000/atom.xml" />

  
    <link rel="stylesheet" href="/css/site.css">
  
</head>
<body>
  <section>
    <header class="navigation">
  <a href="/" class="logo" title="ÄLG, a solitary moose.">
    <img src="/static/moose.png" alt="Moose">
  </a>
  <nav>
    <ul>
      <li><a href="/">writing</a></li>
      <li><a href="/archive">archive</a></li>
      <li><a href="/about">about</a></li>
      <li class="no-bullet"><a href="/atom.xml">rss</a></li>
    </ul>
  </nav>
</header>

<article>
  <h1 class="title">
    Digging around the Github v3 API
  </h1>

  
  <p class="subtitle">
    
      <span>
        
          Series:
          
            
              <a href="/#worklog">worklog</a>
            
          
        
      </span>

      <span class="date">
        July 09, 2011
      </span>
    
  </p>

  <div id="post"><p>I’ve had a little project idea brewing for a while that would require
read and write access to a Github repository with client side Javascript,
which eliminates the ability to use existing libraries like 
<a href="https://github.com/mojombo/grit"><code class="highlighter-rouge">grit</code></a> and 
<a href="https://github.com/libgit2/libgit2"><code class="highlighter-rouge">libgit2</code></a>.</p>

<p>A few of the libraries have
Node.js bindings, but that’s not exactly what I wanted. There is a cool project
called <a href="https://github.com/danlucraft/git.js"><code class="highlighter-rouge">git.js</code></a> that looked like it would be perfect, but it doesn’t (yet) support
any write operations.</p>

<p>Instead, I’ll have to use the <a href="http://developer.github.com/">Github HTTP API</a>.</p>

<p>The real problem was that, prior to v3, the Github API was pretty useless for
working with repositories. You could get the stats (forks, watchers, title, etc)
but the file data wasn’t accessible. I guess you could just scrape the website
to get the data but that’s a little hacky and wouldn’t work for making commits
or pushing changes (theoretically possible now that you can Edit
files online and commit the changes through the web interface?).</p>

<p><em>(Addendum: the v2 did have read access to git objects, but not write access, as
technoweenie from Github points out <a href="http://news.ycombinator.com/item?id=2746877">here</a>)</em></p>

<p>Anyways, the Github v3 API exposes all the 
<a href="http://developer.github.com/v3/git/">raw git data</a> now, so that seems like a much
more robust way to go.</p>

<p>Unfortunately, there is a lack of useful examples on the new API methods; instead
of showing you how to get file at a given commit from the API, you get pointed
to the <a href="http://progit.org/book/ch9-0.html">ProGit ‘Git Internals’ chapter</a>.
So I began to dig into the git internal
plumbing with the goal of getting the latest version of a file from one of my
repos.</p>

<p>I first started looking at the 
<a href="http://developer.github.com/v3/git/blobs/"><code class="highlighter-rouge">/blobs/</code></a> 
API route since that’s where a file
is stored in a git repo. Before I went digging around with the command line
to find the SHA hash for the file, I tried to see if I could get it from the
Github website — however most of the SHA identifiers are for commits, not files.</p>

<p>So that was a dead-end, but a bit of googling later, I found that you can get the
SHA for a file by running <code class="highlighter-rouge">git hash-object FILEPATH</code> (aside: 
<a href="http://stackoverflow.com/questions/552659/assigning-git-sha1s-without-git/552725#552725">this StackOverflow question</a> 
was really insightful too). So I picked a random file from my blog repo and found
the SHA (<code class="highlighter-rouge">957e6b4efb22fa921d0e6b17a1fbf46788c97ed3</code>).</p>

<p>Then I pinged the <code class="highlighter-rouge">/blobs/:sha</code> route with <a href="http://hurl.it">hurl.it</a> and got 
this response:</p>

<script src="https://gist.github.com/1074083.js?file=blobs.json">
</script>

<p>Interesting, the <code class="highlighter-rouge">content</code> field looks promising, <strike>but I <i>think</i> it is the
git <a href="http://book.git-scm.com/7_how_git_stores_objects.html">loose object</a>,
which is the content deflated with <a href="http://www.zlib.net/">zlib</a>.</strike> 
but it is base64 encoded. Not exactly ideal for showing the file contents to the user.</p>

<p>A bit more digging and I found that the API has some 
<a href="http://developer.github.com/v3/mimes/#git-blob">custom MIME types</a>. Adding the 
<code class="highlighter-rouge">Accept: application/vnd.github-blob.raw</code> to the HTTP Header, I got this response:</p>

<script src="https://gist.github.com/1074083.js?file=blobsraw.json">
</script>

<p>Bingo! Access to the file data and it’s human readable. <strike>I suspect that using 
that MIME type causes the API to call <code>git cat-file</code> or something similar on
the server.</strike></p>

<p>Now, I need to be able to get the data for any file in the repo and I would
prefer to not have to use the command line to get the SHA every time. So it looks
like the <a href="http://developer.github.com/v3/git/trees/"><code class="highlighter-rouge">/trees/</code></a>
API method will be useful — it displays the directories and files
present at a given commit. And since you can use branch names (like <code class="highlighter-rouge">master</code>) instead
of SHA (read more <a href="http://book.git-scm.com/4_git_treeishes.html">here</a>), I figured
I could try plugging that into the Github API.</p>

<script src="https://gist.github.com/1074083.js?file=treesmaster.json">
</script>

<p>Cool, it worked. And better yet, the <code class="highlighter-rouge">url</code> field gives me the API URL to call for to
get the file contents (or the tree if it’s a directory).</p>

<p>So given a Github username and repo name, I can pull down the file structure
with <code class="highlighter-rouge">/tree/master</code> and then drill down on the individual files with <code class="highlighter-rouge">/blobs/</code> and the
special MIME type.</p>

<p>More to come later as I try to figure out how to make an edit to a file and commit it
to the repo and more details on the project this is all for once I make more progress.</p>
</div>      

  
    <hr class="fin"/>
  
</article>


  <footer>
  <div id="bio">
    <div id="bio-image">
      <img src="/static/mugshot.jpg" alt="Matt Swanson">
    </div>
    
    <div id="bio-text">
      <p>Hi. I'm <b>Matt Swanson</b>.</p>
      <p>I do things and sometimes write about it here. I'm a Software Engineer from Indiana and I ship code at <a href="http://www.sep.com/">SEP</a>.</p>
      
      <div id="bio-social">
        <strike>Stalk</strike> Follow me:
<div id="social-links">
  <a title="swanson on Github" href="http://github.com/swanson/"><i class="fa fa-github-square"></i></a>
  <a title="swanson on Hacker News" href="http://news.ycombinator.com/user?id=swanson"><i class="fa fa-hacker-news"></i></a>
  <a title="_swanson on Twitter" href="http://twitter.com/_swanson"><i class="fa fa-twitter-square"></i></a>
  <a title="RSS feed" id="rss" href="/atom.xml"><i class="fa fa-rss-square"></i></a>
</div>
      </div>
    </div>
  </div>

  
  <aside>
    <h3>Further reading</h3>
    <ul class="posts">
      
        
        
          
            <li><a href="/blog/2013/08/07/interview-to-implementation-horizon-report.html">Interview to Implementation: Horizon Report</a></li>
          
        
          
            <li><a href="/blog/2013/07/24/step-by-step-ux-improvement-screenshot-upload.html">Step-by-Step UX Improvement: Screenshot Upload</a></li>
          
        
          
            <li><a href="/blog/2011/08/21/update-on-lanyon-crossdomain-ajax-posts.html">Update on Lanyon + Cross-domain AJAX POSTs with CORS</a></li>
          
        
      
    </ul>
  </aside>
  
</footer>

<div id="fine-print">
  <p>
    built with <a href="#">&hearts;</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="https://github.com/swanson/swanson.github.com">GitHub Pages</a> &mdash; read the <a href="/legal">fine print</a>
  </p>
</div>

  </section>

  
</body>
</html>
