<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="VikwqTxe7ybu1qSM7LFgIQpvHLN0_j-iVzaLqF88vEw" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matt Swanson - What is the point of Optionals?</title>
  <meta name="author" content="Matt Swanson" />
  <meta name="description" content="writing on software, book writeups and projects by a software engineer from Indianapolis" />
  
  <link rel="canonical" href="http://mdswanson.com/blog/2015/03/17/what-is-the-point-of-optionals.html" />

  <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/static/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Matt Swanson's Blog" href="http://localhost:4000/atom.xml" />

  
    <link rel="stylesheet" href="/css/site.css">
  
</head>
<body>
  <section>
    <header class="navigation">
  <a href="/" class="logo" title="ÄLG, a solitary moose.">
    <img src="/static/moose.png" alt="Moose">
  </a>
  <nav>
    <ul>
      <li><a href="/">writing</a></li>
      <li><a href="/archive">archive</a></li>
      <li><a href="/about">about</a></li>
      <li class="no-bullet"><a href="/atom.xml">rss</a></li>
    </ul>
  </nav>
</header>

<article>
  <h1 class="title">
    What is the point of Optionals?
  </h1>

  
  <p class="subtitle">
    
      <span>
        
          Series:
          
            
              <a href="/#growth">growth</a>
            
          
        
      </span>

      <span class="date">
        March 17, 2015
      </span>
    
  </p>

  <div id="post"><p>There is a problem with <code class="highlighter-rouge">null</code> (or <code class="highlighter-rouge">nil</code> or <code class="highlighter-rouge">undefined</code>). It has a tendency to propagate throughout your code. Excessive null checking is a sign of unconfident code — “I’m not sure if this could even be <code class="highlighter-rouge">null</code>, might as well check for it…just in case”.</p>

<p>One pattern that developers reach for to help with this is the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code class="highlighter-rouge">Optional</code> class</a>.</p>

<p>So some code like this:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="n">MachineStats</span> <span class="nf">getMachineStatsById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Machine</span> <span class="n">machine</span> <span class="o">=</span> <span class="n">machineService</span><span class="o">.</span><span class="na">getMachine</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    
    <span class="k">if</span> <span class="o">(</span><span class="n">machine</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">machine</span><span class="o">.</span><span class="na">getStats</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">EntityNotFoundExpection</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Becomes this:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="n">MachineStats</span> <span class="nf">getMachineStatsById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Machine</span><span class="o">&gt;</span> <span class="n">machine</span> <span class="o">=</span> <span class="n">machineServive</span><span class="o">.</span><span class="na">getMachine</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    
    <span class="k">if</span> <span class="o">(</span><span class="n">machine</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">machine</span><span class="o">.</span><span class="na">getStats</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">EntityNotFoundExpection</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>At first glance, all that we’ve done is swap a null check for a call to <code class="highlighter-rouge">.isPresent()</code>, so what’s the point? Is this just “Patterns for Patterns Sake”?</p>

<p>I wondered this myself. Like for a long time.</p>

<p>But after listening to an episode of the <a href="http://giantrobots.fm/">Giant Robots podcast</a> on <a href="http://giantrobots.fm/137">Haskell’s Maybe data type</a>, I finally understood why you would prefer <code class="highlighter-rouge">Optional</code> over <code class="highlighter-rouge">null</code>.</p>

<p>It’s all about being expressive.</p>

<p>By returning an <code class="highlighter-rouge">Optional</code>, you are being explicit that the value could be <code class="highlighter-rouge">null</code>. This loosely enforces a contract — if a method returns an <code class="highlighter-rouge">Optional</code>, the caller should handle the <code class="highlighter-rouge">absent</code> case. If a method returns an unwrapped type, then it should be assumed to never be <code class="highlighter-rouge">null</code>.</p>

<p>I can’t speak for Haskell, but at least in Java, this contract has to be more of a convention than a strict enforcement.</p>

<p>But if we follow this convention (and spread this knowledge among the team), we can drastically reduce the need for the defensive null checks that are so frequently sprinkled throughout a codebase.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="n">MachineStats</span> <span class="nf">getMachineStatsById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Machine</span> <span class="n">machine</span> <span class="o">=</span> <span class="n">machineService</span><span class="o">.</span><span class="na">getMachine</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">machine</span><span class="o">.</span><span class="na">getStats</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<p>At the end of the day, using <code class="highlighter-rouge">Optional</code> is more than just a band-aid for covering up <code class="highlighter-rouge">NullPointerExceptions</code>, it is a mechanism to better communicate how your code works to others.</p>

</div>      

  
    <hr class="fin"/>
  
</article>


  <footer>
  <div id="bio">
    <div id="bio-image">
      <img src="/static/mugshot.jpg" alt="Matt Swanson">
    </div>
    
    <div id="bio-text">
      <p>Hi. I'm <b>Matt Swanson</b>.</p>
      <p>I do things and sometimes write about it here. I'm a Software Engineer from Indiana and I ship code at <a href="http://www.sep.com/">SEP</a>.</p>
      
      <div id="bio-social">
        <strike>Stalk</strike> Follow me:
<div id="social-links">
  <a title="swanson on Github" href="http://github.com/swanson/"><i class="fa fa-github-square"></i></a>
  <a title="swanson on Hacker News" href="http://news.ycombinator.com/user?id=swanson"><i class="fa fa-hacker-news"></i></a>
  <a title="_swanson on Twitter" href="http://twitter.com/_swanson"><i class="fa fa-twitter-square"></i></a>
  <a title="RSS feed" id="rss" href="/atom.xml"><i class="fa fa-rss-square"></i></a>
</div>
      </div>
    </div>
  </div>

  
  <aside>
    <h3>Further reading</h3>
    <ul class="posts">
      
        
        
          
            <li><a href="/blog/2017/03/29/how-to-start-a-peer-group.html">How to start a peer group</a></li>
          
        
          
            <li><a href="/blog/2016/03/14/the-first-winter.html">The First Winter</a></li>
          
        
          
            <li><a href="/blog/2015/10/05/testing-behavior-vs-implementation.html">Testing Behavior vs Implementation</a></li>
          
        
      
    </ul>
  </aside>
  
</footer>

<div id="fine-print">
  <p>
    built with <a href="#">&hearts;</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="https://github.com/swanson/swanson.github.com">GitHub Pages</a> &mdash; read the <a href="/legal">fine print</a>
  </p>
</div>

  </section>

  
</body>
</html>
