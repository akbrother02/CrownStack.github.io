<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="VikwqTxe7ybu1qSM7LFgIQpvHLN0_j-iVzaLqF88vEw" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matt Swanson - Testing Behavior vs Implementation</title>
  <meta name="author" content="Matt Swanson" />
  <meta name="description" content="writing on software, book writeups and projects by a software engineer from Indianapolis" />
  
  <link rel="canonical" href="http://mdswanson.com/blog/2015/10/05/testing-behavior-vs-implementation.html" />

  <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/static/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Matt Swanson's Blog" href="http://localhost:4000/atom.xml" />

  
    <link rel="stylesheet" href="/css/site.css">
  
</head>
<body>
  <section>
    <header class="navigation">
  <a href="/" class="logo" title="ÄLG, a solitary moose.">
    <img src="/static/moose.png" alt="Moose">
  </a>
  <nav>
    <ul>
      <li><a href="/">writing</a></li>
      <li><a href="/archive">archive</a></li>
      <li><a href="/about">about</a></li>
      <li class="no-bullet"><a href="/atom.xml">rss</a></li>
    </ul>
  </nav>
</header>

<article>
  <h1 class="title">
    Testing Behavior vs Implementation
  </h1>

  
  <p class="subtitle">
    
      <span>
        
          Series:
          
            
              <a href="/#growth">growth</a>
            
          
        
      </span>

      <span class="date">
        October 05, 2015
      </span>
    
  </p>

  <div id="post"><p>One of the platitudes you run across in software is “Test behavior, not implementation”. Like most software guidelines, it’s great to say and we can all nod along in agreement. But sometimes it’s trickier to identify in practice.</p>

<p>Words like “behavior” and “implementation” are fuzzy and can be open to interpretation. This concept is best taught by example and I came across some code in a project (presented below with modification) that I wanted to share.</p>

<hr />

<p>In this example, we are making a <code class="highlighter-rouge">Backbone.View</code> to render a user submission.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">SubmissionView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"click .upvote"</span><span class="p">:</span> <span class="s2">"upvoteSubmission"</span>
    <span class="p">},</span>

    <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s2">"change"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>

    <span class="na">upvoteSubmission</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"points"</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span> <span class="nx">points</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p>When I looked at the tests for this class, I found a test of the implementation (not the behavior).</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">it</span><span class="p">(</span><span class="s1">'should setup correct events'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">assertEquals</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">"click .upvote"</span><span class="p">:</span> <span class="s2">"upvoteSubmission"</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>The code is testing that the view properly sets up the <code class="highlighter-rouge">event</code> hash by directly comparing it to what we expect it to be. The test passes and this is the idiomatic way of binding events in Backbone. But this test is very concerned with the <em>implementation</em> of <code class="highlighter-rouge">SubmissionView</code>, not the <em>behavior</em>.</p>

<p>The behavior we would like to capture is that “clicking the upvote button will increase the point count by one”. We can test this by doing something like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">it</span><span class="p">(</span><span class="s1">'should add one point when the upvote button is clicked'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"points"</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

    <span class="nx">view</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">".upvote"</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>

    <span class="nx">assertEquals</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"points"</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<hr />

<p>The benefit of writing tests in this style is the ability to change implementation (i.e. refactor) without changing the tests. If you want to use a different view library, you can swap in the new implementation with confidence that it will behave identically.</p>

<p>Testing behavior can be an exercise in patience when you already know the code you want to write. Making assertions about the implementation can be a shortcut to “TDDing” your code into the design you already have in your mind. But in the long run, the trade-off is a brittle test suite that will resist refactoring and changes to the internals of your code.</p>
</div>      

  
    <hr class="fin"/>
  
</article>


  <footer>
  <div id="bio">
    <div id="bio-image">
      <img src="/static/mugshot.jpg" alt="Matt Swanson">
    </div>
    
    <div id="bio-text">
      <p>Hi. I'm <b>Matt Swanson</b>.</p>
      <p>I do things and sometimes write about it here. I'm a Software Engineer from Indiana and I ship code at <a href="http://www.sep.com/">SEP</a>.</p>
      
      <div id="bio-social">
        <strike>Stalk</strike> Follow me:
<div id="social-links">
  <a title="swanson on Github" href="http://github.com/swanson/"><i class="fa fa-github-square"></i></a>
  <a title="swanson on Hacker News" href="http://news.ycombinator.com/user?id=swanson"><i class="fa fa-hacker-news"></i></a>
  <a title="_swanson on Twitter" href="http://twitter.com/_swanson"><i class="fa fa-twitter-square"></i></a>
  <a title="RSS feed" id="rss" href="/atom.xml"><i class="fa fa-rss-square"></i></a>
</div>
      </div>
    </div>
  </div>

  
  <aside>
    <h3>Further reading</h3>
    <ul class="posts">
      
        
        
          
            <li><a href="/blog/2017/03/29/how-to-start-a-peer-group.html">How to start a peer group</a></li>
          
        
          
            <li><a href="/blog/2016/03/14/the-first-winter.html">The First Winter</a></li>
          
        
          
        
      
    </ul>
  </aside>
  
</footer>

<div id="fine-print">
  <p>
    built with <a href="#">&hearts;</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="https://github.com/swanson/swanson.github.com">GitHub Pages</a> &mdash; read the <a href="/legal">fine print</a>
  </p>
</div>

  </section>

  
</body>
</html>
